{"version":3,"sources":["panels/Home.js","panels/Persik.js","App.js","index.js"],"names":["Home","_ref","id","go","_React$useState","React","useState","_React$useState2","Object","slicedToArray","preview","setPreview","_React$useState3","_React$useState4","result","setResult","react_default","a","createElement","es6","top","before","document_default","size","level","onChange","e","URL","createObjectURL","target","files","onClick","data-to","className","src","alt","Fragment","style","margin","Persik","props","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","videoRef","createRef","canvasRef","detectFrame","video","model","detect","then","predictions","renderPredictions","requestAnimationFrame","ctx","current","getContext","clearRect","canvas","width","height","font","textBaseline","forEach","prediction","x","bbox","y","strokeStyle","lineWidth","strokeRect","fillStyle","textWidth","measureText","class","textHeight","parseInt","fillRect","fillText","state","isLoading","_this2","md","MobileDetect","window","navigator","userAgent","console","log","mobile","mediaDevices","getUserMedia","webCamPromise","audio","facingMode","exact","stream","srcObject","Promise","resolve","reject","onloadedmetadata","modelPromise","cocoSsd","all","values","catch","error","finally","setState","left","back_default","autoPlay","playsInline","muted","ref","Component","App","activePanel","currentTarget","dataset","to","fetchedUser","connect","subscribe","detail","type","data","send","panels_Home","src_panels_Persik","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.959c94b3.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Panel, Button, Group, Div, PanelHeader, File, Separator } from '@vkontakte/vkui';\nimport Icon24Document from '@vkontakte/icons/dist/24/document';\n\nconst Home = ({ id, go }) => {\n\tconst [preview, setPreview] = React.useState(null)\n\tconst [result, setResult] = React.useState(null)\n\n\tfunction handleChangeFile(e) {\n\t\tsetPreview(URL.createObjectURL(e.target.files[0]));\n\t\tsetResult(URL.createObjectURL(e.target.files[0]));\n\t}\n\n\treturn (\n\t\t<Panel id={id}>\n\t\t\t<PanelHeader>Главная</PanelHeader>\n\t\t\t<Group>\n\t\t\t\t<Div>\n\t\t\t\t\t<File\n\t\t\t\t\t\ttop=\"Загрузить\"\n\t\t\t\t\t\tbefore={<Icon24Document />}\n\t\t\t\t\t\tsize=\"xl\"\n\t\t\t\t\t\tlevel=\"secondary\"\n\t\t\t\t\t\tonChange={handleChangeFile}\n\t\t\t\t\t/>\n\t\t\t\t</Div>\n\t\t\t\t<Div>\n\t\t\t\t\t<Button size=\"xl\" level=\"2\" onClick={go} data-to=\"persik\">\n\t\t\t\t\t\tСделать фото\n\t\t\t\t\t</Button>\n\t\t\t\t</Div>\n\t\t\t</Group>\n\t\t\t<Group>\n\t\t\t\t{\n\t\t\t\t\tpreview && (\n\t\t\t\t\t\t<img className=\"Preview\" src={preview} alt=\"\"/>\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\t{\n\t\t\t\t\tresult && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<Separator style={{ margin: '12px 0' }} />\n\t\t\t\t\t\t\t<img className=\"Preview\" src={result} alt=\"\"/>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t</Group>\n\t\t</Panel>\n\t)\n};\n\nHome.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n\tfetchedUser: PropTypes.shape({\n\t\tphoto_200: PropTypes.string,\n\t\tfirst_name: PropTypes.string,\n\t\tlast_name: PropTypes.string,\n\t\tcity: PropTypes.shape({\n\t\t\ttitle: PropTypes.string,\n\t\t}),\n\t}),\n};\n\nexport default Home;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Panel, PanelHeader, HeaderButton, Group, Spinner } from '@vkontakte/vkui';\nimport './Persik.css';\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\n\nimport * as cocoSsd from \"@tensorflow-models/coco-ssd\";\nimport \"@tensorflow/tfjs\";\n\nimport MobileDetect from 'mobile-detect';\n\nclass Persik extends React.Component {\n  videoRef = React.createRef();\n\tcanvasRef = React.createRef();\n\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis.state = {\n\t\t\tisLoading: true\n\t\t}\n\t}\n\tcomponentDidMount() {\n\t\tconst md = new MobileDetect(window.navigator.userAgent);\n\t\tconsole.log(!md.mobile())\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n      const webCamPromise = navigator.mediaDevices\n        .getUserMedia({\n          audio: false,\n          video: {\n            facingMode: !md.mobile() ? \"user\" : { exact: \"environment\" }\n          }\n        })\n        .then(stream => {\n          window.stream = stream;\n          this.videoRef.current.srcObject = stream;\n          return new Promise((resolve, reject) => {\n            this.videoRef.current.onloadedmetadata = () => {\n              resolve();\n            };\n          });\n        });\n      const modelPromise = cocoSsd.load();\n      Promise.all([modelPromise, webCamPromise])\n        .then(values => {\n\t\t\t\t\tthis.detectFrame(this.videoRef.current, values[0]);\n        })\n        .catch(error => {\n          console.error(error);\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tconsole.log('then')\n\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tisLoading: false\n\t\t\t\t\t})\n\t\t\t\t\tconsole.log('finally')\n\t\t\t\t})\n    }\n  }\n\n  detectFrame = (video, model) => {\n    model.detect(video).then(predictions => {\n      this.renderPredictions(predictions);\n      requestAnimationFrame(() => {\n        this.detectFrame(video, model);\n      });\n    });\n  };\n\n  renderPredictions = predictions => {\n    const ctx = this.canvasRef.current.getContext(\"2d\");\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n    const font = \"16px sans-serif\";\n    ctx.font = font;\n    ctx.textBaseline = \"top\";\n    predictions.forEach(prediction => {\n      const x = prediction.bbox[0];\n      const y = prediction.bbox[1];\n      const width = prediction.bbox[2];\n      const height = prediction.bbox[3];\n\n      ctx.strokeStyle = \"#00FFFF\";\n      ctx.lineWidth = 4;\n      ctx.strokeRect(x, y, width, height);\n\n      ctx.fillStyle = \"#00FFFF\";\n      const textWidth = ctx.measureText(prediction.class).width;\n      const textHeight = parseInt(font, 10);\n      ctx.fillRect(x, y, textWidth + 4, textHeight + 4);\n    });\n\n    predictions.forEach(prediction => {\n      const x = prediction.bbox[0];\n      const y = prediction.bbox[1];\n\n      ctx.fillStyle = \"#000000\";\n      ctx.fillText(prediction.class, x, y);\n    });\n  };\n\n  render() {\n\t\tconst props = this.props\n    return (\n\t\t\t\t<Panel id={props.id}>\n\t\t\t\t\t<PanelHeader\n\t\t\t\t\t\tleft={<HeaderButton onClick={props.go} data-to=\"home\">\n\t\t\t\t\t\t\t<Icon24Back/>\n\t\t\t\t\t\t</HeaderButton>}\n\t\t\t\t\t>\n\t\t\t\t\t\tРезультаты\n\t\t\t\t\t</PanelHeader>\n\t\t\t\t\t<Group>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.state.isLoading && (\n\t\t\t\t\t\t\t\t<div className='Preloader'>\n\t\t\t\t\t\t\t\t\t<Spinner className=\"Spinner\" /> <span>Подготовка помощника</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) \n\t\t\t\t\t\t}\n\t\t\t\t\t\t<section className=\"Wrapper\">\n\t\t\t\t\t\t\t<video\n\t\t\t\t\t\t\t\tautoPlay\n\t\t\t\t\t\t\t\tplaysInline\n\t\t\t\t\t\t\t\tmuted\n\t\t\t\t\t\t\t\tref={this.videoRef}\n\t\t\t\t\t\t\t\twidth=\"300\"\n\t\t\t\t\t\t\t\theight=\"300\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<canvas\n\t\t\t\t\t\t\t\tclassName=\"Canvas\"\n\t\t\t\t\t\t\t\tref={this.canvasRef}\n\t\t\t\t\t\t\t\twidth=\"300\"\n\t\t\t\t\t\t\t\theight=\"300\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</section>\n\t\t\t\t\t</Group>\n\t\t\t\t</Panel>\n\n    );\n  }\n}\nPersik.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n};\n\nexport default Persik;\n","import React from 'react';\nimport connect from '@vkontakte/vkui-connect';\nimport { View } from '@vkontakte/vkui';\nimport '@vkontakte/vkui/dist/vkui.css';\n\nimport Home from './panels/Home';\nimport Persik from './panels/Persik';\n\nclass App extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tactivePanel: 'home',\n\t\t\tfetchedUser: null,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconnect.subscribe((e) => {\n\t\t\tswitch (e.detail.type) {\n\t\t\t\tcase 'VKWebAppGetUserInfoResult':\n\t\t\t\t\tthis.setState({ fetchedUser: e.detail.data });\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.log(e.detail.type);\n\t\t\t}\n\t\t});\n\t\tconnect.send('VKWebAppGetUserInfo', {});\n\t}\n\n\tgo = (e) => {\n\t\tthis.setState({ activePanel: e.currentTarget.dataset.to })\n\t};\n\n\trender() {\n\t\treturn (\n\t\t\t<View activePanel={this.state.activePanel}>\n\t\t\t\t<Home id=\"home\" fetchedUser={this.state.fetchedUser} go={this.go} />\n\t\t\t\t<Persik id=\"persik\" go={this.go} />\n\t\t\t</View>\n\t\t);\n\t}\n}\n\nexport default App;\n","import 'core-js/es6/map';\nimport 'core-js/es6/set';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport connect from '@vkontakte/vkui-connect';\nimport App from './App';\n// import registerServiceWorker from './sw';\n\n// Init VK App\nconnect.send('VKWebAppInit', {});\n\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\n// расскомментируйте строку с registerServiceWorker();\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT \n// registerServiceWorker();\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}