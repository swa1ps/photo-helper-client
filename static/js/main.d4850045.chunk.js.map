{"version":3,"sources":["panels/Home.js","panels/Persik.js","App.js","index.js"],"names":["Home","_ref","id","go","_React$useState","React","useState","_React$useState2","Object","slicedToArray","href","setHref","react_default","a","createElement","es6","top","before","document_default","size","level","onChange","e","console","log","URL","createObjectURL","target","files","onClick","data-to","className","src","alt","Persik","platform","videoRef","createRef","canvasRef","detectFrame","video","model","detect","then","predictions","_this","renderPredictions","requestAnimationFrame","ctx","current","getContext","clearRect","canvas","width","height","font","textBaseline","forEach","prediction","x","bbox","y","strokeStyle","lineWidth","strokeRect","fillStyle","textWidth","measureText","class","textHeight","parseInt","fillRect","fillText","_this2","this","navigator","mediaDevices","getUserMedia","webCamPromise","audio","facingMode","stream","window","srcObject","Promise","resolve","reject","onloadedmetadata","modelPromise","cocoSsd","all","values","catch","error","props","left","back_default","autoPlay","playsInline","muted","ref","Component","App","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","setState","activePanel","currentTarget","dataset","to","state","fetchedUser","connect","subscribe","detail","type","data","send","panels_Home","src_panels_Persik","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.d4850045.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Panel, Button, Group, Div, PanelHeader, File } from '@vkontakte/vkui';\nimport Icon24Document from '@vkontakte/icons/dist/24/document';\n\nconst Home = ({ id, go }) => {\n\tconst [href, setHref] = React.useState(null)\n\n\tfunction handleChangeFile(e) {\n\t\tconsole.log(e)\n\t\tsetHref(URL.createObjectURL(e.target.files[0]));\n\t}\n\n\treturn (\n\t\t<Panel id={id}>\n\t\t\t<PanelHeader>Главная</PanelHeader>\n\t\t\t<Group>\n\t\t\t\t<Div>\n\t\t\t\t\t<File\n\t\t\t\t\t\ttop=\"Загрузить\"\n\t\t\t\t\t\tbefore={<Icon24Document />}\n\t\t\t\t\t\tsize=\"xl\"\n\t\t\t\t\t\tlevel=\"secondary\"\n\t\t\t\t\t\tonChange={handleChangeFile}\n\t\t\t\t\t/>\n\t\t\t\t</Div>\n\t\t\t\t<Div>\n\t\t\t\t\t<Button size=\"xl\" level=\"2\" onClick={go} data-to=\"persik\">\n\t\t\t\t\t\tСделать фото\n\t\t\t\t\t</Button>\n\t\t\t\t</Div>\n\t\t\t</Group>\n\t\t\t<Group>\n\t\t\t\t{\n\t\t\t\t\thref && (\n\t\t\t\t\t\t<img className=\"Preview\" src={href} alt=\"\"/>\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t</Group>\n\t\t</Panel>\n\t)\n};\n\nHome.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n\tfetchedUser: PropTypes.shape({\n\t\tphoto_200: PropTypes.string,\n\t\tfirst_name: PropTypes.string,\n\t\tlast_name: PropTypes.string,\n\t\tcity: PropTypes.shape({\n\t\t\ttitle: PropTypes.string,\n\t\t}),\n\t}),\n};\n\nexport default Home;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Panel, PanelHeader, HeaderButton, platform, Group } from '@vkontakte/vkui';\nimport './Persik.css';\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\n\nimport * as cocoSsd from \"@tensorflow-models/coco-ssd\";\nimport \"@tensorflow/tfjs\";\n\nconst osname = platform();\n\nclass Persik extends React.Component {\n  videoRef = React.createRef();\n  canvasRef = React.createRef();\n\n  componentDidMount() {\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n      const webCamPromise = navigator.mediaDevices\n        .getUserMedia({\n          audio: false,\n          video: {\n            facingMode: \"environment\"\n          }\n        })\n        .then(stream => {\n          window.stream = stream;\n          this.videoRef.current.srcObject = stream;\n          return new Promise((resolve, reject) => {\n            this.videoRef.current.onloadedmetadata = () => {\n              resolve();\n            };\n          });\n        });\n      const modelPromise = cocoSsd.load();\n      Promise.all([modelPromise, webCamPromise])\n        .then(values => {\n          this.detectFrame(this.videoRef.current, values[0]);\n        })\n        .catch(error => {\n          console.error(error);\n        });\n    }\n  }\n\n  detectFrame = (video, model) => {\n    model.detect(video).then(predictions => {\n      this.renderPredictions(predictions);\n      requestAnimationFrame(() => {\n        this.detectFrame(video, model);\n      });\n    });\n  };\n\n  renderPredictions = predictions => {\n    const ctx = this.canvasRef.current.getContext(\"2d\");\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n    const font = \"16px sans-serif\";\n    ctx.font = font;\n    ctx.textBaseline = \"top\";\n    predictions.forEach(prediction => {\n      const x = prediction.bbox[0];\n      const y = prediction.bbox[1];\n      const width = prediction.bbox[2];\n      const height = prediction.bbox[3];\n\n      ctx.strokeStyle = \"#00FFFF\";\n      ctx.lineWidth = 4;\n      ctx.strokeRect(x, y, width, height);\n\n      ctx.fillStyle = \"#00FFFF\";\n      const textWidth = ctx.measureText(prediction.class).width;\n      const textHeight = parseInt(font, 10);\n      ctx.fillRect(x, y, textWidth + 4, textHeight + 4);\n    });\n\n    predictions.forEach(prediction => {\n      const x = prediction.bbox[0];\n      const y = prediction.bbox[1];\n\n      ctx.fillStyle = \"#000000\";\n      ctx.fillText(prediction.class, x, y);\n    });\n  };\n\n  render() {\n\t\tconst props = this.props\n    return (\n\t\t\t\t<Panel id={props.id}>\n\t\t\t\t\t<PanelHeader\n\t\t\t\t\t\tleft={<HeaderButton onClick={props.go} data-to=\"home\">\n\t\t\t\t\t\t\t<Icon24Back/>\n\t\t\t\t\t\t</HeaderButton>}\n\t\t\t\t\t>\n\t\t\t\t\t\tРезультаты\n\t\t\t\t\t</PanelHeader>\n\t\t\t\t\t<Group>\n\t\t\t\t\t\t<section className=\"Wrapper\">\n\t\t\t\t\t\t\t<video\n\t\t\t\t\t\t\t\tautoPlay\n\t\t\t\t\t\t\t\tplaysInline\n\t\t\t\t\t\t\t\tmuted\n\t\t\t\t\t\t\t\tref={this.videoRef}\n\t\t\t\t\t\t\t\twidth=\"300\"\n\t\t\t\t\t\t\t\theight=\"300\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<canvas\n\t\t\t\t\t\t\t\tclassName=\"Canvas\"\n\t\t\t\t\t\t\t\tref={this.canvasRef}\n\t\t\t\t\t\t\t\twidth=\"300\"\n\t\t\t\t\t\t\t\theight=\"300\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</section>\n\t\t\t\t\t</Group>\n\t\t\t\t</Panel>\n\n    );\n  }\n}\nPersik.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n};\n\nexport default Persik;\n","import React from 'react';\nimport connect from '@vkontakte/vkui-connect';\nimport { View } from '@vkontakte/vkui';\nimport '@vkontakte/vkui/dist/vkui.css';\n\nimport Home from './panels/Home';\nimport Persik from './panels/Persik';\n\nclass App extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tactivePanel: 'home',\n\t\t\tfetchedUser: null,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconnect.subscribe((e) => {\n\t\t\tswitch (e.detail.type) {\n\t\t\t\tcase 'VKWebAppGetUserInfoResult':\n\t\t\t\t\tthis.setState({ fetchedUser: e.detail.data });\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.log(e.detail.type);\n\t\t\t}\n\t\t});\n\t\tconnect.send('VKWebAppGetUserInfo', {});\n\t}\n\n\tgo = (e) => {\n\t\tthis.setState({ activePanel: e.currentTarget.dataset.to })\n\t};\n\n\trender() {\n\t\treturn (\n\t\t\t<View activePanel={this.state.activePanel}>\n\t\t\t\t<Home id=\"home\" fetchedUser={this.state.fetchedUser} go={this.go} />\n\t\t\t\t<Persik id=\"persik\" go={this.go} />\n\t\t\t</View>\n\t\t);\n\t}\n}\n\nexport default App;\n","import 'core-js/es6/map';\nimport 'core-js/es6/set';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport connect from '@vkontakte/vkui-connect';\nimport App from './App';\n// import registerServiceWorker from './sw';\n\n// Init VK App\nconnect.send('VKWebAppInit', {});\n\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\n// расскомментируйте строку с registerServiceWorker();\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT \n// registerServiceWorker();\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}